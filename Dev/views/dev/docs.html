{% extends '../layouts/devLayout.html' %}
{% block body %}

<div class="page-header">
    <h1>CubbyHole API Documentation</h1>
</div>
<blockquote>
    <p>{{__('API Documentation is only available in english at the moment !')}}</p>
</blockquote>
<div class="col-md-2" role="navigation">
    <div class="list-group">
        <a href="#auth" class="list-group-item">Authentication</a>
        <a href="#account" class="list-group-item">Account</a>
    </div>
</div><!--/span-->
    <div class="col-md-10">
        <h1 id="auth">I - Authentication</h1>
        <blockquote>
            <p>Go <a href="/addApp">there</a> if you want to register your new application !</p>
        </blockquote>
        <p>
            We use oAuth2 as authentication system for our API, here's a few steps to learn using it in a few steps
        </p>
        <h3>1 - Creating redirection URL and redirect the user</h3>
        <p>The following URL must me customized with your redirection URI (on your application) and your client id.</p>
        <pre>https://localhost:8444/auth/dialog/authorize?redirect_uri={REDIRECT_URI}&response_type=code&client_id={CLIENT_ID}</pre>
        <p>You have to redirect the user to this url where he will have to log on our application and authorize your application, he will be redirected to your redirection URI then with a code :</p>
        <pre>http://your-redirect.uri/?code=0aPqiS649G9TcEaJ</pre>
        <p>Keep this code, you will need it in the next step !</p>

        <h3>2 - Getting Access Token</h3>
        <p>Well, now you get an Authorization Code (valid for 5 minutes) you must get the access token to communicate with the API. To achieve this, just send a post request to :</p>
        <pre>https://localhost:8444/auth/oauth/token</pre>
        <p>You need to precise the Content-Type as application/x-www-form-urlencoded with a HTTP header</p>
        <p>Finally, you just have to add this as a request body, replace the Authorization Code with the one you got before, and the Client Secret with the one which was given to you when you registered the application.</p>
        <pre>code={AUTHORIZATION_CODE}&redirect_uri={REDIRECT_URI}&client_id={CLIENT_ID}&client_secret={CLIENT_SECRET}&grant_type=authorization_code</pre>
        <p>If all your informations are right, you will get an access token in the body of the response :</p>
        <pre>{
    "access_token": "8LFxvvqtPslmxcSDSrEYM6dSbRSCzdAMkY0zPAKmJ6xvQJRpHxCBIYCs8EcBuIdRA5KfwMMKpsPlEJINSG1AADuQHcnYTvmVSr6NwP4jttHCu35hwYaIWovMu8H9lvseSKigtJHeMgprekFGov87uvz5t4vqJConWkKP07ToqPrwV7vSE0x3fpthVy4z9qbFxjx7oRWoyp87LDQohRFlClAiE3DlTHTqKK36FbTguLf5z3un7RjACynO3CGLsutj",
    "token_type": "bearer"
}
        </pre>
        This token is valid as long as your user doesn't remove the authorization for your application on its account, so keep it preciously !
        <h3>3 - Request the API</h3>
        <p>This is the easiest part, you just have to do a GET/POST/PUT/DELETE request on our api with adding the Authorization HTTP Header (Don't forget to add the keyword 'Bearer' followed by the Access Token) : </p>
        <pre>Authorization: Bearer 8LFxvvqtPslmxcSDSrEYM6dSbRSCzdAMkY0zPAKmJ6xvQJRpHxCBIYCs8EcBuIdRA5KfwMMKpsPlEJINSG1AADuQHcnYTvmVSr6NwP4jttHCu35hwYaIWovMu8H9lvseSKigtJHeMgprekFGov87uvz5t4vqJConWkKP07ToqPrwV7vSE0x3fpthVy4z9qbFxjx7oRWoyp87LDQohRFlClAiE3DlTHTqKK36FbTguLf5z3un7RjACynO3CGLsutj</pre>

        <br/><br/>
        <h1 id="account">II - Account Infos</h1>
        <h3>1 - Get logged user infos</h3>
        <pre>https://localhost:8444/api/account/details</pre>
        <ul>
            <li>Method : GET</li>
            <li>Authentication : Required</li>
            <li>Additional parameters : No</li>
        </ul>
        <p>Typical response : </p>
        <pre>{
    "id": 1,
    "username": "bob",
    "email": "bob@mail.com",
    "name": "bob"
}</pre>
</div><!--/row-->
{% endblock %}